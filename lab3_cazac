# Лабораторная работа №3  
Аутентификация и авторизация в Node.js (JWT)

**Цель работы**
- Освоить механизм аутентификации и авторизации в backend-приложениях на Node.js.
- Реализовать регистрацию и вход пользователей.
- Научиться защищать REST API с помощью JWT (JSON Web Token).
- Реализовать разграничение доступа в зависимости от роли пользователя.

---

## **Описание проекта**
В ходе лабораторной работы был расширен существующий сервис **ToDo REST API**:

- добавлена система пользователей;
- реализована безопасная регистрация и вход (bcrypt + JWT);
- теперь доступ к защищённым ресурсам возможен только при наличии токена;
- добавлены роли (`user`, `admin`);
- разграничены права пользователей.

# **Структура базы данных**

## Таблица `users`
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password TEXT NOT NULL,
    role VARCHAR(20) DEFAULT 'user',
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);


Регистрация пользователя
{
  "username": "testuser",
  "email": "test@mail.com",
  "password": "123456"
}

Вход пользователя

{
  "email": "test@mail.com",
  "password": "123456"
}

Получение профиля
Authorization: Bearer <JWT>

{
  "id": 1,
  "username": "testuser",
  "role": "user"
}

Защита маршрутов
const jwt = require("jsonwebtoken");

module.exports = (req, res, next) => {
    try {
        const header = req.headers.authorization;
        if (!header) return res.status(401).json({ error: "Missing token" });

        const token = header.split(" ")[1];
        const decoded = jwt.verify(token, process.env.JWT_SECRET);

        req.user = decoded;
        next();
    } catch {
        res.status(401).json({ error: "Invalid token" });
    }
};

Контрольные вопросы
1. Что такое JWT?

JWT — это компактный токен, содержащий закодированные данные пользователя, подписанные секретным ключом.

2. В чём отличие аутентификации и авторизации?

Аутентификация - подтверждение личности (кто ты?)
Авторизация - проверка прав (что тебе разрешено?)

3. Зачем хэшировать пароли?

Чтобы даже при утечке базы злоумышленник не получил реальные пароли.

4. Какие преимущества у JWT?

- лёгкий
- хранится на клиенте
- работает без сессий
- подходит для микросервисов
